@startuml Sequence - Login & Otorisasi

actor User
participant "Login Page\n(Livewire)" as Login
participant "Auth Facade" as Auth
participant "User Model" as UserModel
participant Session
database DB

User -> Login: GET /login
Login --> User: Form login

User -> Login: POST email, password
Login -> Auth: attempt(credentials)
Auth -> UserModel: where(email)
UserModel -> DB: SELECT * FROM users\nWHERE email=?
DB --> UserModel: user|null

alt User not found
    Auth --> Login: false
    Login --> User: Error kredensial
else Found
    Auth -> Auth: Hash::check()
    
    alt Password salah
        Auth --> Login: false
        Login --> User: Error kredensial
    else Password benar
        Auth -> UserModel: check is_active
        
        alt Tidak aktif
            Auth --> Login: false
            Login --> User: Akun tidak aktif
        else Aktif
            Auth -> Session: regenerate()
            Auth -> Session: store(user_id)
            Auth --> Login: true
            Login -> UserModel: hasAnyPermission()
            UserModel -> DB: SELECT permissions
            
            alt Ada permission
                Login --> User: Redirect dashboard\n(ringkasan sesuai role)
            else Tidak ada
                Login --> User: Redirect menunggu-peran
            end
        end
    end
end

@enduml
