@startuml Sequence Diagram - Mengelola Produk

actor Inventori
participant "Product Page\n(Livewire)" as Page
participant "Product\nModel" as Product
participant "ProductComposition\nModel" as Composition
participant "OtherCost\nModel" as Cost
participant "Material\nModel" as Material
database Database as DB

== Menambah Produk Baru ==
Inventori -> Page: Klik "Tambah Produk"
Page --> Inventori: Tampilkan form produk

Inventori -> Page: Isi data produk
Inventori -> Page: Pilih kategori
Inventori -> Page: Upload gambar (opsional)

alt Produk dengan Resep
    Inventori -> Page: Tambah komposisi bahan
    
    loop Untuk setiap bahan
        Inventori -> Page: Pilih bahan baku
        Page -> Material: query()->where('is_active', true)
        Material -> DB: SELECT * FROM materials
        DB --> Material: materials list
        Material --> Page: available materials
        
        Inventori -> Page: Masukkan jumlah & satuan
        Page -> Page: Tambah ke array komposisi
    end
    
    Inventori -> Page: Tambah biaya tambahan (opsional)
    
    loop Untuk setiap biaya
        Inventori -> Page: Pilih jenis biaya
        Inventori -> Page: Masukkan nominal
        Page -> Page: Tambah ke array biaya
    end
    
    Page -> Page: Hitung modal produk
    note right
      modal = Σ(harga_bahan × qty)
            + Σ(biaya_tambahan)
    end note
end

Inventori -> Page: Simpan produk

== Menyimpan ke Database ==
Page -> Product: create(productData)
Product -> DB: INSERT INTO products
DB --> Product: product created

alt Ada Komposisi
    loop Untuk setiap komposisi
        Page -> Composition: create(compositionData)
        Composition -> DB: INSERT INTO product_compositions
    end
end

alt Ada Biaya Tambahan
    loop Untuk setiap biaya
        Page -> Cost: create(costData)
        Cost -> DB: INSERT INTO other_costs
    end
end

Page --> Inventori: Produk berhasil ditambahkan

== Mengedit Produk ==
Inventori -> Page: Pilih produk
Page -> Product: find(id)->with(['compositions', 'costs'])
Product -> DB: SELECT dengan relasi
DB --> Product: product data
Product --> Page: product with relations
Page --> Inventori: Tampilkan form edit

Inventori -> Page: Ubah data
Inventori -> Page: Simpan perubahan

Page -> Product: update(data)
Product -> DB: UPDATE products
DB --> Product: updated

Page -> Composition: sync(newCompositions)
Page -> Cost: sync(newCosts)

Page --> Inventori: Produk berhasil diupdate

== Menghapus Produk ==
Inventori -> Page: Pilih hapus produk
Page --> Inventori: Konfirmasi hapus?
Inventori -> Page: Konfirmasi

Page -> Product: checkTransactions(id)
Product -> DB: SELECT FROM transaction_details WHERE product_id = ?

alt Produk pernah di transaksi
    Page --> Inventori: Peringatan: Akan di-soft delete
    Page -> Product: update(['is_active' => false])
else Tidak ada transaksi
    Page -> Product: delete(id)
    Product -> DB: DELETE FROM products
end

Page --> Inventori: Produk berhasil dihapus

@enduml
