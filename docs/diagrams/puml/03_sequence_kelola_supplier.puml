@startuml Sequence Diagram - Mengelola Supplier

title Sequence Diagram: Mengelola Supplier

actor Inventori as I
participant "Halaman Supplier" as H
participant "SupplierIndex\nComponent" as S
participant "Supplier\nModel" as M
database "Database" as DB

== Melihat Daftar Supplier ==

I -> H: Akses halaman supplier
activate H
H -> S: mount()
activate S
S -> M: Supplier::withCount('expenses')->get()
activate M
M -> DB: SELECT * FROM suppliers
M -> DB: SELECT COUNT expenses
DB --> M: Data supplier
M --> S: Collection supplier
deactivate M
S --> H: Render daftar
deactivate S
H --> I: Tampilkan halaman
deactivate H

== Menambah Supplier ==

I -> H: Klik tombol Tambah
H --> I: Tampilkan modal form
I -> S: set('name', 'Toko Bahan Kue')
I -> S: set('phone', '08123456789')
I -> S: set('address', 'Jl. Pasar...')
I -> S: save()
activate S
S -> S: validate()
S -> M: Supplier::create([...])
activate M
M -> DB: INSERT INTO suppliers
DB --> M: Success
M --> S: Supplier baru
deactivate M
S --> H: Tutup modal
S --> H: Flash message sukses
deactivate S

== Melihat Riwayat Belanja ==

I -> H: Klik nama supplier
H -> S: showHistory(supplier)
activate S
S -> M: supplier->expenses()->with('details')->get()
activate M
M -> DB: SELECT * FROM expenses WHERE supplier_id = ?
M -> DB: SELECT * FROM expense_details
DB --> M: Riwayat belanja
M --> S: Collection expense
deactivate M
S --> H: Tampilkan modal riwayat
deactivate S

note right
  Riwayat menampilkan:
  - Tanggal belanja
  - Total pembelian
  - Bahan yang dibeli
  - Status pembayaran
end note

== Mengedit Supplier ==

I -> H: Klik tombol Edit
H -> S: edit(supplier)
activate S
S --> H: Tampilkan form edit
deactivate S
I -> S: Ubah data
I -> S: update()
activate S
S -> S: validate()
S -> M: supplier->update([...])
activate M
M -> DB: UPDATE suppliers SET ...
DB --> M: Success
M --> S: Updated
deactivate M
S --> H: Flash message sukses
deactivate S

== Menghapus Supplier ==

I -> H: Klik tombol Hapus
H --> I: Konfirmasi hapus
I -> S: delete(supplier)
activate S
S -> M: supplier->expenses()->count()
activate M
M -> DB: SELECT COUNT FROM expenses
DB --> M: count
M --> S: jumlah belanja
deactivate M

alt Tidak ada riwayat belanja
    S -> M: supplier->delete()
    activate M
    M -> DB: DELETE FROM suppliers
    DB --> M: Success
    M --> S: Deleted
    deactivate M
    S --> H: Flash message sukses
else Ada riwayat belanja
    S --> H: Error: Supplier memiliki riwayat
end

deactivate S

@enduml
