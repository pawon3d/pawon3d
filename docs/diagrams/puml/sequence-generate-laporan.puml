@startuml sequence-generate-laporan

title Sequence Diagram: Generate Laporan PDF/Excel

actor "Pengguna" as user
participant "Dashboard/LaporanKasir\n(Livewire)" as dashboard
participant "Dashboard/ExportKasir\n(Livewire)" as export
participant "PdfController" as controller
participant "TransaksiExport\n(Maatwebsite)" as exporter
participant "DomPDF" as pdf
participant "Transaction Model" as model
database "Database" as db

== Akses Dashboard Laporan ==

user -> dashboard : Akses halaman laporan kasir
activate dashboard

dashboard -> model : query dengan filter default
model -> db : SELECT * FROM transactions JOIN ...
db --> model : transactions data
model --> dashboard : Collection

dashboard --> user : Tampilkan statistik dan grafik

user -> dashboard : Atur filter periode\n(tanggal mulai - selesai)

dashboard -> model : query dengan filter baru
model -> db : SELECT * WHERE date BETWEEN ? AND ?
db --> model : filtered data
model --> dashboard : Collection

dashboard --> user : Tampilkan data terfilter

deactivate dashboard

== Export ke PDF ==

user -> export : Akses halaman export
activate export

user -> export : Konfirmasi periode
user -> export : Klik Export PDF

export -> controller : laporanKasir(request)
activate controller

controller -> model : query data laporan
model -> db : SELECT dengan filter
db --> model : data
model --> controller : Collection

controller -> pdf : loadView('pdf.laporan-kasir', data)
activate pdf

pdf -> pdf : Render HTML to PDF
pdf --> controller : PDF stream

deactivate pdf

controller --> export : PDF response
deactivate controller

export --> user : Download file PDF

deactivate export

== Export ke Excel ==

user -> export : Akses halaman export
activate export

user -> export : Konfirmasi periode
user -> export : Klik Export Excel

export -> controller : kasirExcel(request)
activate controller

controller -> exporter : download('laporan-kasir.xlsx')
activate exporter

exporter -> model : query data
model -> db : SELECT dengan filter
db --> model : data
model --> exporter : Collection

exporter -> exporter : Format data ke spreadsheet
exporter -> exporter : Apply styling

exporter --> controller : Excel response

deactivate exporter

controller --> export : Excel response
deactivate controller

export --> user : Download file Excel

deactivate export

@enduml
