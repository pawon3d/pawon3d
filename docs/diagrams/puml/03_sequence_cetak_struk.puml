@startuml Sequence Diagram - Cetak Struk

actor Kasir
participant "Receipt Page\n(Livewire)" as Receipt
participant "Transaction\nModel" as Transaction
participant "TransactionDetail\nModel" as TxDetail
participant "Payment\nModel" as Payment
participant "StoreProfile\nModel" as Store
participant "PdfController" as PDF
participant "NotificationService" as Notif
database Database as DB

== Buka Halaman Cetak Struk ==
Kasir -> Receipt: GET /cetak-struk/{id}

Receipt -> Transaction: find(id)->with(['details.product', 'payments', 'customer'])
Transaction -> DB: SELECT with relationships
DB --> Transaction: transaction data

Receipt -> Store: first()
Store -> DB: SELECT * FROM store_profiles LIMIT 1
DB --> Store: store profile
Store --> Receipt: store data

Receipt --> Kasir: Tampilkan preview struk

== Generate PDF ==
Kasir -> PDF: GET /transaksi/cetak/{id}

PDF -> Transaction: find(id)->with(...)
Transaction --> PDF: transaction + details

PDF -> Store: first()
Store --> PDF: store profile

PDF -> PDF: Generate PDF dengan DomPDF
note right
  Data struk:
  - Logo & nama toko
  - Alamat toko
  - No. Invoice
  - Tanggal
  - Item pesanan
  - Total
  - Metode pembayaran
  - Kasir
end note

PDF --> Kasir: Download/tampilkan PDF

== Kirim Notifikasi (opsional) ==
Kasir -> Receipt: Klik "Tandai Sudah Dicetak"
Receipt -> Notif: receiptPrinted(receipt_number, invoice_number)
Notif -> DB: INSERT INTO notifications

Receipt --> Kasir: Struk berhasil dicetak

@enduml
