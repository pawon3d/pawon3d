@startuml

skinparam linetype ortho
hide circle

title ERD - Increment 1\nModul Inti Operasional

' ==========================================
' ENTITAS AUTENTIKASI & PENGGUNA
' ==========================================

entity "users" as users {
    *id : UUID <<PK>>
    --
    name : VARCHAR(50)
    email : VARCHAR(255) <<UNIQUE>>
    phone : VARCHAR(20)
    password : VARCHAR(255)
    image : VARCHAR(255)
    gender : VARCHAR(20)
    is_active : BOOLEAN
    remember_token : VARCHAR(100)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "roles" as roles {
    *id : BIGINT <<PK>>
    --
    name : VARCHAR(100)
    guard_name : VARCHAR(50)
    max_users : INT
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "permissions" as permissions {
    *id : BIGINT <<PK>>
    --
    name : VARCHAR(100)
    guard_name : VARCHAR(50)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "model_has_roles" as model_has_roles {
    *role_id : BIGINT <<PK,FK>>
    *model_id : UUID <<PK>>
    *model_type : VARCHAR(100) <<PK>>
}

entity "role_has_permissions" as role_has_permissions {
    *permission_id : BIGINT <<PK,FK>>
    *role_id : BIGINT <<PK,FK>>
}

' ==========================================
' ENTITAS PELANGGAN
' ==========================================

entity "customers" as customers {
    *id : UUID <<PK>>
    --
    phone : VARCHAR(20) <<UNIQUE>>
    name : VARCHAR(50)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

' ==========================================
' ENTITAS PRODUK & KATEGORI
' ==========================================

entity "categories" as categories {
    *id : UUID <<PK>>
    --
    name : VARCHAR(50)
    is_active : BOOLEAN
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "products" as products {
    *id : UUID <<PK>>
    --
    name : VARCHAR(50)
    description : VARCHAR(50)
    price : DECIMAL(10,0)
    stock : DECIMAL(10,0)
    method : JSON
    product_image : VARCHAR(255)
    is_recipe : BOOLEAN
    is_active : BOOLEAN
    is_recommended : BOOLEAN
    is_other : BOOLEAN
    pcs : DECIMAL(10,0)
    pcs_capital : DECIMAL(10,0)
    capital : DECIMAL(10,0)
    suhu_ruangan : DECIMAL(3,0)
    suhu_dingin : DECIMAL(3,0)
    suhu_beku : DECIMAL(3,0)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "product_categories" as product_categories {
    *id : UUID <<PK>>
    --
    product_id : UUID <<FK>>
    category_id : UUID <<FK>>
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "type_costs" as type_costs {
    *id : UUID <<PK>>
    --
    name : VARCHAR(100)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "other_costs" as other_costs {
    *id : UUID <<PK>>
    --
    product_id : UUID <<FK>>
    type_cost_id : UUID <<FK>>
    name : VARCHAR(100)
    price : DECIMAL(15,2)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "units" as units {
    *id : UUID <<PK>>
    --
    name : VARCHAR(20) <<UNIQUE>>
    alias : VARCHAR(10)
    group : VARCHAR(20)
    base_unit_id : UUID <<FK>>
    conversion_factor : DECIMAL(20,10)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

' ==========================================
' ENTITAS BAHAN BAKU
' ==========================================

entity "materials" as materials {
    *id : UUID <<PK>>
    --
    name : VARCHAR(100)
    description : VARCHAR(255)
    image : VARCHAR(255)
    expiry_date : DATE
    status : VARCHAR(50)
    is_active : BOOLEAN
    is_recipe : BOOLEAN
    minimum : DECIMAL(15,5)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "material_details" as material_details {
    *id : UUID <<PK>>
    --
    material_id : UUID <<FK>>
    unit_id : UUID <<FK>>
    supply_price : DECIMAL(15,2)
    is_main : BOOLEAN
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "material_batches" as material_batches {
    *id : UUID <<PK>>
    --
    material_id : UUID <<FK>>
    unit_id : UUID <<FK>>
    batch_number : VARCHAR(50)
    date : DATE
    batch_quantity : DECIMAL(15,2)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "product_compositions" as product_compositions {
    *id : UUID <<PK>>
    --
    product_id : UUID <<FK>>
    material_id : UUID <<FK>>
    unit_id : UUID <<FK>>
    material_quantity : DECIMAL(8,2)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "ingredient_categories" as ingredient_categories {
    *id : UUID <<PK>>
    --
    name : VARCHAR(100)
    description : VARCHAR(255)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "ingredient_category_details" as ingredient_category_details {
    *id : UUID <<PK>>
    --
    ingredient_category_id : UUID <<FK>>
    material_id : UUID <<FK>>
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

' ==========================================
' ENTITAS SUPPLIER & BELANJA
' ==========================================

entity "suppliers" as suppliers {
    *id : UUID <<PK>>
    --
    name : VARCHAR(100)
    description : VARCHAR(255)
    contact_name : VARCHAR(50)
    phone : VARCHAR(20)
    street : VARCHAR(255)
    landmark : VARCHAR(200)
    maps_link : VARCHAR(500)
    image : VARCHAR(255)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "expenses" as expenses {
    *id : UUID <<PK>>
    --
    expense_number : VARCHAR(50) <<UNIQUE>>
    expense_date : DATE
    end_date : DATE
    supplier_id : UUID <<FK>>
    note : TEXT
    status : VARCHAR(50)
    grand_total_expect : DECIMAL(10,2)
    grand_total_actual : DECIMAL(10,2)
    is_start : BOOLEAN
    is_finish : BOOLEAN
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "expense_details" as expense_details {
    *id : UUID <<PK>>
    --
    expense_id : UUID <<FK>>
    material_id : UUID <<FK>>
    unit_id : UUID <<FK>>
    quantity_expect : DECIMAL(15,5)
    quantity_get : DECIMAL(15,5)
    is_quantity_get : BOOLEAN
    price_expect : DECIMAL(10,2)
    price_get : DECIMAL(10,2)
    total_expect : DECIMAL(10,2)
    total_actual : DECIMAL(10,2)
    expiry_date : DATE
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

' ==========================================
' ENTITAS PRODUKSI
' ==========================================

entity "productions" as productions {
    *id : UUID <<PK>>
    --
    production_number : VARCHAR(50)
    transaction_id : UUID <<FK>>
    method : VARCHAR(50)
    date : DATE
    time : TIME
    start_date : DATE
    end_date : DATE
    note : TEXT
    status : VARCHAR(50)
    is_start : BOOLEAN
    is_finish : BOOLEAN
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "production_details" as production_details {
    *id : UUID <<PK>>
    --
    production_id : UUID <<FK>>
    product_id : UUID <<FK>>
    quantity_plan : DECIMAL(8,0)
    quantity_get : DECIMAL(8,0)
    quantity_fail : DECIMAL(8,0)
    cycle : DECIMAL(2,0)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "production_workers" as production_workers {
    *id : UUID <<PK>>
    --
    production_id : UUID <<FK>>
    user_id : UUID <<FK>>
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

' ==========================================
' ENTITAS TRANSAKSI
' ==========================================

entity "shifts" as shifts {
    *id : UUID <<PK>>
    --
    shift_number : VARCHAR(50) <<UNIQUE>>
    opened_by : UUID <<FK>>
    closed_by : UUID <<FK>>
    start_time : DATETIME
    end_time : DATETIME
    status : VARCHAR(50)
    initial_cash : DECIMAL(10,0)
    final_cash : DECIMAL(10,0)
    total_sales : DECIMAL(10,2)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "transactions" as transactions {
    *id : UUID <<PK>>
    --
    user_id : UUID <<FK>>
    customer_id : UUID <<FK>>
    invoice_number : VARCHAR(30) <<UNIQUE>>
    name : VARCHAR(50)
    phone : VARCHAR(20)
    date : DATE
    time : TIME
    start_date : DATE
    end_date : DATE
    note : TEXT
    payment_status : VARCHAR(20)
    status : VARCHAR(20)
    method : VARCHAR(20)
    total_amount : DECIMAL(15,0)
    created_by_shift : UUID <<FK>>
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "transaction_details" as transaction_details {
    *id : UUID <<PK>>
    --
    transaction_id : UUID <<FK>>
    product_id : UUID <<FK>>
    quantity : SMALLINT
    price : DECIMAL(15,0)
    pcs_capital_snapshot : DECIMAL(15,2)
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "payment_channels" as payment_channels {
    *id : UUID <<PK>>
    --
    type : VARCHAR(10)
    group : VARCHAR(50)
    bank_name : VARCHAR(50)
    account_number : VARCHAR(100)
    account_name : VARCHAR(50)
    qris_image : VARCHAR(255)
    is_active : BOOLEAN
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

entity "payments" as payments {
    *id : UUID <<PK>>
    --
    receipt_number : VARCHAR(30) <<UNIQUE>>
    transaction_id : UUID <<FK>>
    payment_channel_id : UUID <<FK>>
    payment_method : VARCHAR(20)
    payment_group : VARCHAR(20)
    paid_amount : DECIMAL(15,0)
    image : VARCHAR(255)
    paid_at : TIMESTAMP
    created_at : TIMESTAMP
    updated_at : TIMESTAMP
}

' ==========================================
' RELASI
' ==========================================

users ||--o{ model_has_roles
roles ||--o{ model_has_roles
roles ||--o{ role_has_permissions
permissions ||--o{ role_has_permissions

users ||--o{ shifts : "opened_by/closed_by"
users ||--o{ transactions
users ||--o{ production_workers

customers ||--o{ transactions

categories ||--o{ product_categories
products ||--o{ product_categories
products ||--o{ product_compositions
products ||--o{ transaction_details
products ||--o{ production_details
products ||--o{ other_costs
type_costs ||--o{ other_costs

units ||--o{ units : "base_unit"
units ||--o{ material_details
units ||--o{ material_batches
units ||--o{ product_compositions
units ||--o{ expense_details

materials ||--o{ material_details
materials ||--o{ material_batches
materials ||--o{ product_compositions
materials ||--o{ expense_details
materials ||--o{ ingredient_category_details

ingredient_categories ||--o{ ingredient_category_details

suppliers ||--o{ expenses
expenses ||--o{ expense_details

productions ||--o{ production_details
productions ||--o{ production_workers
productions }o--|| transactions : "optional"

shifts ||--o{ transactions : "created_by_shift"
transactions ||--o{ transaction_details
transactions ||--o{ payments

payment_channels ||--o{ payments

@enduml
