@startuml

skinparam activityShape octagon

title Activity Diagram\nProses Pembayaran (UC-10)

|Kasir|
start
:Akses halaman\nProses Pembayaran;

|System|
:Load data transaksi\n(Status: Menunggu Pembayaran);
:Tampilkan detail transaksi;

|Kasir|
:Pilih Grup Pembayaran;
note right
  - Tunai
  - Non-Tunai
end note

if (Non-Tunai?) then (Ya)
  :Pilih Tipe Pembayaran;
  note right
    - Transfer
    - E-Wallet
    - QRIS
  end note
  
  :Pilih Channel Pembayaran;
  |System|
  :Tampilkan Detail\nRekening/Nomor;
endif

|Kasir|
:Input Jumlah Pembayaran;
:Upload Bukti Pembayaran;

|System|
:Validasi Input;

if (Metode = Siap Beli?) then (Ya)
  if (Pembayaran < Total?) then (Ya)
    :Tampilkan Error\n"Harus lunas 100%";
    stop
  endif
else (Pesanan Reguler/Kotak)
  if (Pembayaran < 50% Total?) then (Ya)
    :Tampilkan Error\n"Minimum DP 50%";
    stop
  endif
endif

-> Pembayaran Valid;
:Simpan data Pembayaran;
:Upload Gambar Bukti;
:Hitung Kembalian;

if (Metode = Siap Beli?) then (Ya)
  :Kurangi Stok Produk;
  note right
    Reduce stock untuk:
    - Produk resep (recipe products)
    - Produk siap jual (ready-to-sell)
    via material batches
  end note
  
  if (Pembayaran = Total?) then (Ya - Lunas)
    :Set Status = 'Selesai';
  else (Tidak - Belum Lunas)
    :Set Status = 'Belum Diproses';
  endif
else (Pesanan Reguler/Kotak)
  :Set Status = 'Belum Diproses';
endif

:Kirim Notifikasi\n"Order Queued";

if (Pembayaran >= Total?) then (Ya)
  :Kirim Notifikasi\n"Payment Completed";
else (Tidak)
  :Kirim Notifikasi\n"Payment Down Payment";
endif

:Generate Struk Digital;

|Kasir|
if (Cetak struk?) then (Ya)
  :Cetak struk pembayaran;
endif

:Tampilkan notifikasi sukses;

if (Lihat riwayat transaksi?) then (Ya)
  |System|
  :Tampilkan daftar transaksi;
  :Filter berdasarkan\nperiode/status;
endif

stop

@enduml
