@startuml Activity Diagram - Login dan Otorisasi

|User|
start
:Membuka halaman login;
:Memasukkan email;
:Memasukkan password;
:Klik tombol Login;

|Sistem|
:Validasi format input;

if (Format valid?) then (Ya)
    :Mencari user berdasarkan email;
    
    if (User ditemukan?) then (Ya)
        :Verifikasi password;
        
        if (Password benar?) then (Ya)
            if (Akun aktif (is_active)?) then (Ya)
                :Membuat session;
                :Mengambil roles dan permissions;
                
                if (User punya permission?) then (Ya)
                    :Redirect ke Dashboard sesuai permission;
                    
                    |User|
                    :Melihat Dashboard;
                    :Melihat menu sesuai permission;
                    note right
                      Menu yang tampil berdasarkan:
                      - kasir.* -> Menu Kasir
                      - produksi.* -> Menu Produksi
                      - inventori.* -> Menu Inventori
                      - manajemen.* -> Menu Manajemen
                    end note
                else (Tidak)
                    :Redirect ke halaman "Menunggu Peran";
                    |User|
                    :Melihat pesan menunggu penugasan peran;
                    :Hubungi administrator;
                endif
                
            else (Tidak)
                :Menampilkan error "Akun tidak aktif";
                note right
                  Akun bisa nonaktif karena:
                  - Belum aktivasi
                  - Dinonaktifkan pemilik
                end note
            endif
            
        else (Tidak)
            :Menampilkan error "Password salah";
        endif
        
    else (Tidak)
        :Menampilkan error "User tidak ditemukan";
    endif
    
else (Tidak)
    :Menampilkan error validasi;
endif

stop

@enduml
