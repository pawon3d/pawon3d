@startuml Sequence Diagram - Mengelola Metode Pembayaran

title Sequence Diagram: Mengelola Metode Pembayaran

actor Pemilik as P
participant "Halaman Payment\nChannel" as H
participant "PaymentChannel\nComponent" as PC
participant "PaymentChannel\nModel" as M
database "Database" as DB

== Melihat Daftar Channel Pembayaran ==

P -> H: Akses halaman payment channel
activate H
H -> PC: mount()
activate PC
PC -> M: PaymentChannel::all()
activate M
M -> DB: SELECT * FROM payment_channels
DB --> M: Data channel
M --> PC: Collection channel
deactivate M
PC --> H: Render daftar
deactivate PC
H --> P: Tampilkan halaman
deactivate H

note right
  Daftar menampilkan:
  - Logo/Icon
  - Nama channel
  - Nomor rekening
  - Status aktif/nonaktif
end note

== Menambah Channel ==

P -> H: Klik tombol Tambah
H --> P: Tampilkan modal form
P -> PC: set('name', 'BCA')
P -> PC: set('type', 'Bank Transfer')
P -> PC: set('account_number', '1234567890')
P -> PC: set('account_name', 'Toko Kue')
P -> PC: set('is_active', true)
P -> PC: save()
activate PC
PC -> PC: validate()
PC -> M: PaymentChannel::create([...])
activate M
M -> DB: INSERT INTO payment_channels
DB --> M: Success
M --> PC: Channel baru
deactivate M
PC --> H: Tutup modal
PC --> H: Flash message sukses
deactivate PC

== Toggle Status Aktif/Nonaktif ==

P -> H: Klik toggle status
H -> PC: toggleStatus(channel)
activate PC
PC -> M: channel->update(['is_active' => !current])
activate M
M -> DB: UPDATE payment_channels SET is_active = ?
DB --> M: Success
M --> PC: Updated
deactivate M

alt Status menjadi aktif
    PC --> H: "Channel diaktifkan"
    note right
      Channel akan muncul
      di pilihan pembayaran kasir
    end note
else Status menjadi nonaktif
    PC --> H: "Channel dinonaktifkan"
    note right
      Channel tidak muncul
      di pilihan pembayaran kasir
    end note
end

deactivate PC

== Mengedit Channel ==

P -> H: Klik tombol Edit
H -> PC: edit(channel)
activate PC
PC --> H: Tampilkan form edit
deactivate PC
P -> PC: Ubah nomor rekening
P -> PC: update()
activate PC
PC -> PC: validate()
PC -> M: channel->update([...])
activate M
M -> DB: UPDATE payment_channels SET ...
DB --> M: Success
M --> PC: Updated
deactivate M
PC --> H: Flash message sukses
deactivate PC

== Menghapus Channel ==

P -> H: Klik tombol Hapus
H --> P: Konfirmasi hapus
P -> PC: delete(channel)
activate PC
PC -> M: channel->payments()->count()
activate M
M -> DB: SELECT COUNT FROM payments WHERE channel_id = ?
DB --> M: count
M --> PC: jumlah payment
deactivate M

alt Tidak ada transaksi menggunakan channel
    PC -> M: channel->delete()
    activate M
    M -> DB: DELETE FROM payment_channels
    DB --> M: Success
    M --> PC: Deleted
    deactivate M
    PC --> H: Flash message sukses
else Ada transaksi menggunakan channel
    PC --> H: Error: Channel digunakan
    PC --> H: "Nonaktifkan saja channel ini"
end

deactivate PC

@enduml
