@startuml Class Diagram - Sistem Manajemen Toko Kue

' ============================
' PACKAGE: USER & AUTHENTICATION
' ============================
package "User & Authentication" {
    class User {
        +id: bigint
        +name: string
        +email: string
        +password: string
        +phone: string
        +is_active: boolean
        +activated_at: timestamp
        +invitation_token: string
        +created_at: timestamp
        +updated_at: timestamp
        --
        +roles()
        +permissions()
        +hasAnyPermission()
    }

    class Role {
        +id: bigint
        +name: string
        +guard_name: string
        +created_at: timestamp
        +updated_at: timestamp
        --
        +permissions()
        +users()
    }

    class Permission {
        +id: bigint
        +name: string
        +guard_name: string
        +created_at: timestamp
        +updated_at: timestamp
        --
        +roles()
    }

    User "1" -- "*" Role : has >
    Role "1" -- "*" Permission : has >
}

' ============================
' PACKAGE: CUSTOMER & POINTS
' ============================
package "Customer & Points" {
    class Customer {
        +id: bigint
        +name: string
        +phone: string
        +address: text
        +points: integer
        +is_active: boolean
        +created_at: timestamp
        +updated_at: timestamp
        --
        +transactions()
        +pointsHistories()
    }

    class PointsHistory {
        +id: bigint
        +phone: string
        +action: enum
        +points: integer
        +transaction_id: bigint
        +created_at: timestamp
        --
        +transaction()
    }

    Customer "1" -- "*" PointsHistory : has >
}

' ============================
' PACKAGE: PRODUCT MANAGEMENT
' ============================
package "Product Management" {
    class Product {
        +id: bigint
        +category_id: bigint
        +code: string
        +name: string
        +image: string
        +description: text
        +stock: integer
        +price: decimal
        +is_ready: boolean
        +is_active: boolean
        +created_at: timestamp
        +updated_at: timestamp
        --
        +category()
        +compositions()
        +productions()
    }

    class Category {
        +id: bigint
        +name: string
        +is_active: boolean
        +created_at: timestamp
        +updated_at: timestamp
        --
        +products()
    }

    class ProductComposition {
        +id: bigint
        +product_id: bigint
        +material_id: bigint
        +quantity: decimal
        +created_at: timestamp
        +updated_at: timestamp
        --
        +product()
        +material()
    }

    Category "1" -- "*" Product : has >
    Product "1" -- "*" ProductComposition : has >
}

' ============================
' PACKAGE: MATERIAL & INVENTORY
' ============================
package "Material & Inventory" {
    class Material {
        +id: bigint
        +ingredient_category_id: bigint
        +unit_id: bigint
        +code: string
        +name: string
        +image: string
        +description: text
        +is_active: boolean
        +created_at: timestamp
        +updated_at: timestamp
        --
        +ingredientCategory()
        +unit()
        +batches()
    }

    class IngredientCategory {
        +id: bigint
        +name: string
        +is_active: boolean
        +created_at: timestamp
        +updated_at: timestamp
        --
        +materials()
    }

    class Unit {
        +id: bigint
        +name: string
        +is_active: boolean
        +created_at: timestamp
        +updated_at: timestamp
        --
        +materials()
    }

    class MaterialBatch {
        +id: bigint
        +material_id: bigint
        +batch_number: string
        +date: date
        +batch_quantity: decimal
        +created_at: timestamp
        +updated_at: timestamp
        --
        +material()
    }

    class InventoryLog {
        +id: bigint
        +material_id: bigint
        +action: enum
        +quantity_change: decimal
        +reference_type: string
        +reference_id: bigint
        +created_at: timestamp
        --
        +material()
    }

    IngredientCategory "1" -- "*" Material : has >
    Unit "1" -- "*" Material : has >
    Material "1" -- "*" MaterialBatch : has >
    Material "1" -- "*" InventoryLog : has >
}

' ============================
' PACKAGE: TRANSACTION
' ============================
package "Transaction" {
    class Transaction {
        +id: bigint
        +invoice_number: string
        +customer_id: bigint
        +method: enum
        +status: enum
        +payment_status: enum
        +schedule: datetime
        +total_amount: decimal
        +total_refund: decimal
        +note: text
        +created_by_shift: bigint
        +refund_by_shift: bigint
        +created_at: timestamp
        +updated_at: timestamp
        --
        +customer()
        +details()
        +payments()
        +production()
        +refund()
        +shift()
    }

    class TransactionDetail {
        +id: bigint
        +transaction_id: bigint
        +product_id: bigint
        +quantity: integer
        +unit_price: decimal
        +sub_total: decimal
        +created_at: timestamp
        +updated_at: timestamp
        --
        +transaction()
        +product()
    }

    class Payment {
        +id: bigint
        +transaction_id: bigint
        +payment_method: string
        +payment_channel_id: bigint
        +paid_amount: decimal
        +receipt_number: string
        +proof_image: string
        +created_at: timestamp
        +updated_at: timestamp
        --
        +transaction()
        +channel()
    }

    class PaymentChannel {
        +id: bigint
        +name: string
        +type: enum
        +account_number: string
        +account_name: string
        +is_active: boolean
        +created_at: timestamp
        +updated_at: timestamp
        --
        +payments()
    }

    class Refund {
        +id: bigint
        +transaction_id: bigint
        +reason: text
        +refund_method: string
        +payment_channel_id: bigint
        +account_number: string
        +total_amount: decimal
        +proof_image: string
        +refund_by_shift: bigint
        +refunded_at: timestamp
        +created_at: timestamp
        +updated_at: timestamp
        --
        +transaction()
        +channel()
    }

    class Shift {
        +id: bigint
        +shift_number: string
        +opened_by: bigint
        +closed_by: bigint
        +start_time: timestamp
        +end_time: timestamp
        +initial_cash: decimal
        +final_cash: decimal
        +total_sales: decimal
        +total_refunds: decimal
        +status: enum
        +created_at: timestamp
        +updated_at: timestamp
        --
        +opener()
        +closer()
        +transactions()
    }

    Transaction "1" -- "*" TransactionDetail : has >
    Transaction "1" -- "*" Payment : has >
    Transaction "1" -- "0..1" Refund : has >
    Transaction "*" -- "0..1" Shift : created in >
    Payment "*" -- "1" PaymentChannel : uses >
    Refund "*" -- "0..1" PaymentChannel : uses >
}

' ============================
' PACKAGE: PRODUCTION
' ============================
package "Production" {
    class Production {
        +id: bigint
        +production_number: string
        +transaction_id: bigint
        +method: enum
        +status: enum
        +worker_id: bigint
        +is_start: boolean
        +is_finish: boolean
        +start_date: datetime
        +end_date: datetime
        +created_at: timestamp
        +updated_at: timestamp
        --
        +transaction()
        +worker()
        +details()
    }

    class ProductionDetail {
        +id: bigint
        +production_id: bigint
        +product_id: bigint
        +quantity_expect: integer
        +quantity_get: integer
        +quantity_fail: integer
        +created_at: timestamp
        +updated_at: timestamp
        --
        +production()
        +product()
    }

    Production "1" -- "*" ProductionDetail : has >
    Production "*" -- "1" User : assigned to >
}

' ============================
' PACKAGE: EXPENSE (BELANJA)
' ============================
package "Expense" {
    class Expense {
        +id: bigint
        +expense_number: string
        +supplier_id: bigint
        +status: enum
        +is_start: boolean
        +is_finish: boolean
        +grand_total_expect: decimal
        +grand_total_actual: decimal
        +created_at: timestamp
        +updated_at: timestamp
        --
        +supplier()
        +details()
    }

    class ExpenseDetail {
        +id: bigint
        +expense_id: bigint
        +material_id: bigint
        +quantity_expect: decimal
        +quantity_get: decimal
        +price_expect: decimal
        +price_get: decimal
        +total_expect: decimal
        +total_actual: decimal
        +expiry_date: date
        +is_quantity_get: boolean
        +created_at: timestamp
        +updated_at: timestamp
        --
        +expense()
        +material()
    }

    class Supplier {
        +id: bigint
        +name: string
        +phone: string
        +address: text
        +is_active: boolean
        +created_at: timestamp
        +updated_at: timestamp
        --
        +expenses()
    }

    Supplier "1" -- "*" Expense : has >
    Expense "1" -- "*" ExpenseDetail : has >
}

' ============================
' PACKAGE: STOCK COUNT (HITUNG)
' ============================
package "Stock Count" {
    class Hitung {
        +id: bigint
        +hitung_number: string
        +user_id: bigint
        +action: enum
        +status: enum
        +is_start: boolean
        +is_finish: boolean
        +hitung_date: datetime
        +hitung_date_finish: datetime
        +grand_total: decimal
        +loss_grand_total: decimal
        +created_at: timestamp
        +updated_at: timestamp
        --
        +user()
        +details()
    }

    class HitungDetail {
        +id: bigint
        +hitung_id: bigint
        +material_id: bigint
        +quantity_expect: decimal
        +quantity_actual: decimal
        +total: decimal
        +loss_total: decimal
        +created_at: timestamp
        +updated_at: timestamp
        --
        +hitung()
        +material()
    }

    Hitung "1" -- "*" HitungDetail : has >
    Hitung "*" -- "1" User : created by >
}

' ============================
' PACKAGE: STORE SETTINGS
' ============================
package "Store Settings" {
    class StoreSetting {
        +id: bigint
        +key: string
        +value: text
        +type: enum
        +created_at: timestamp
        +updated_at: timestamp
    }

    class StoreDocument {
        +id: bigint
        +type_cost_id: bigint
        +document_number: string
        +document_name: string
        +nominal: decimal
        +started_date: date
        +ended_date: date
        +file_path: string
        +status: enum
        +created_at: timestamp
        +updated_at: timestamp
        --
        +typeCost()
    }

    class TypeCost {
        +id: bigint
        +name: string
        +is_active: boolean
        +created_at: timestamp
        +updated_at: timestamp
        --
        +documents()
    }

    class Notification {
        +id: string
        +type: string
        +notifiable_type: string
        +notifiable_id: bigint
        +data: json
        +read_at: timestamp
        +created_at: timestamp
        +updated_at: timestamp
    }

    TypeCost "1" -- "*" StoreDocument : has >
}

' ============================
' CROSS-PACKAGE RELATIONSHIPS
' ============================
Customer "1" -- "*" Transaction : makes >
User "1" -- "*" Transaction : creates >
User "1" -- "*" Shift : manages >
Product "1" -- "*" TransactionDetail : sold in >
Product "1" -- "*" ProductionDetail : produced in >
Material "1" -- "*" ProductComposition : used in >
Material "1" -- "*" ExpenseDetail : purchased in >
Material "1" -- "*" HitungDetail : counted in >
Transaction "0..1" -- "0..1" Production : triggers >

@enduml
