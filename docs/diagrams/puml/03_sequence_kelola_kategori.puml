@startuml Sequence Diagram - Mengelola Kategori Produk

title Sequence Diagram: Mengelola Kategori Produk

actor Inventori as I
participant "Halaman Kategori" as H
participant "CategoryIndex\nComponent" as C
participant "Category\nModel" as M
database "Database" as DB

== Melihat Daftar Kategori ==

I -> H: Akses halaman kategori
activate H
H -> C: mount()
activate C
C -> M: Category::withCount('products')->get()
activate M
M -> DB: SELECT * FROM categories
M -> DB: SELECT COUNT products
DB --> M: Data kategori dengan jumlah produk
M --> C: Collection kategori
deactivate M
C --> H: Render daftar kategori
deactivate C
H --> I: Tampilkan halaman
deactivate H

== Menambah Kategori ==

I -> H: Klik tombol Tambah
H --> I: Tampilkan form tambah
I -> C: set('name', 'Kue Basah')
I -> C: set('description', 'Kue dengan...')
I -> C: save()
activate C
C -> C: validate()
C -> M: Category::create([...])
activate M
M -> DB: INSERT INTO categories
DB --> M: Success
M --> C: Kategori baru
deactivate M
C --> H: Flash message sukses
C --> H: Refresh daftar
deactivate C

== Mengedit Kategori ==

I -> H: Klik tombol Edit
H -> C: edit(category)
activate C
C --> H: Tampilkan form edit
deactivate C
I -> C: Ubah data
I -> C: update()
activate C
C -> C: validate()
C -> M: category->update([...])
activate M
M -> DB: UPDATE categories SET ...
DB --> M: Success
M --> C: Updated
deactivate M
C --> H: Flash message sukses
deactivate C

== Menghapus Kategori ==

I -> H: Klik tombol Hapus
H --> I: Konfirmasi hapus
I -> C: delete(category)
activate C
C -> M: category->products()->count()
activate M
M -> DB: SELECT COUNT FROM products
DB --> M: count = 0
M --> C: 0 produk
deactivate M

alt Kategori tidak punya produk
    C -> M: category->delete()
    activate M
    M -> DB: DELETE FROM categories
    DB --> M: Success
    M --> C: Deleted
    deactivate M
    C --> H: Flash message sukses
else Kategori punya produk
    C --> H: Error: Kategori memiliki produk
end

deactivate C

@enduml
