@startuml

skinparam classAttributeIconSize 0
skinparam linetype ortho
hide empty members

title Class Diagram - Increment 1\nModul Inti Operasional

' ==========================================
' KELAS INTI (INCREMENT 1)
' ==========================================

package "Autentikasi & Pengguna" #LightBlue {
    class User {
        -id: UUID
        -name: String
        -email: String
        -phone: String
        -password: String
        -image: String
        -gender: String
        -is_active: Boolean
        --
        +initials(): String
    }

    class Role {
        -id: BigInteger
        -name: String
        -guard_name: String
        -max_users: Integer
        --
        +permissions(): BelongsToMany
        +users(): BelongsToMany
    }

    class Permission {
        -id: BigInteger
        -name: String
        -guard_name: String
        --
        +roles(): BelongsToMany
    }
}

package "Pelanggan" #LightGreen {
    class Customer {
        -id: UUID
        -phone: String
        -name: String
        --
        +transactions(): HasMany
    }
}

package "Produk & Kategori" #LightYellow {
    class Category {
        -id: UUID
        -name: String
        -is_active: Boolean
        --
        +products(): BelongsToMany
        +productCategories(): HasMany
    }

    class Product {
        -id: UUID
        -name: String
        -description: String
        -price: Decimal
        -stock: Decimal
        -method: JSON
        -product_image: String
        -is_recipe: Boolean
        -is_active: Boolean
        -is_recommended: Boolean
        -capital: Decimal
        -pcs: Decimal
        -pcs_capital: Decimal
        --
        +getAvailableStock(): Integer
        +otherCosts(): HasMany
    }

    class ProductCategory {
        -id: UUID
        -product_id: UUID
        -category_id: UUID
    }

    class TypeCost {
        -id: UUID
        -name: String
        --
        +otherCosts(): HasMany
    }

    class OtherCost {
        -id: UUID
        -product_id: UUID
        -type_cost_id: UUID
        -price: Decimal
        --
        +product(): BelongsTo
        +typeCost(): BelongsTo
    }

    class Unit {
        -id: UUID
        -name: String
        -alias: String
        -group: String
        -base_unit_id: UUID
        -conversion_factor: Decimal
        --
        +baseUnit(): BelongsTo
        +children(): HasMany
        +convertTo(targetUnit, value): Float
    }
}

package "Bahan Baku" #LightCoral {
    class Material {
        -id: UUID
        -name: String
        -description: String
        -image: String
        -expiry_date: Date
        -status: String
        -is_active: Boolean
        -is_recipe: Boolean
        -minimum: Decimal
        --
        +getTotalQuantityInUnit(unit): Float
        +reduceQuantity(qty, unit): Boolean
        +getUnitPriceInUnit(unit): Float
        +recalculateStatus(): void
        +batches(): HasMany
        +materialDetails(): HasMany
    }

    class MaterialDetail {
        -id: UUID
        -material_id: UUID
        -unit_id: UUID
        -supply_price: Decimal
        -is_main: Boolean
        --
        +material(): BelongsTo
        +unit(): BelongsTo
    }

    class MaterialBatch {
        -id: UUID
        -material_id: UUID
        -unit_id: UUID
        -batch_number: String
        -date: Date
        -batch_quantity: Decimal
        --
        +material(): BelongsTo
        +unit(): BelongsTo
    }

    class ProductComposition {
        -id: UUID
        -product_id: UUID
        -material_id: UUID
        -unit_id: UUID
        -material_quantity: Decimal
        --
        +product(): BelongsTo
        +material(): BelongsTo
        +unit(): BelongsTo
    }

    class IngredientCategory {
        -id: UUID
        -name: String
        -description: String
        --
        +details(): HasMany
        +materials(): BelongsToMany
    }

    class IngredientCategoryDetail {
        -id: UUID
        -ingredient_category_id: UUID
        -material_id: UUID
        --
        +ingredientCategory(): BelongsTo
        +material(): BelongsTo
    }
}

package "Supplier & Belanja" #Lavender {
    class Supplier {
        -id: UUID
        -name: String
        -description: String
        -contact_name: String
        -phone: String
        -street: String
        -landmark: String
        -maps_link: String
        -image: String
        --
        +expenses(): HasMany
    }

    class Expense {
        -id: UUID
        -expense_number: String
        -expense_date: Date
        -end_date: Date
        -supplier_id: UUID
        -note: String
        -status: String
        -grand_total_expect: Decimal
        -grand_total_actual: Decimal
        -is_start: Boolean
        -is_finish: Boolean
        --
        +supplier(): BelongsTo
        +expenseDetails(): HasMany
        +generateExpenseNumber(): String
    }

    class ExpenseDetail {
        -id: UUID
        -expense_id: UUID
        -material_id: UUID
        -unit_id: UUID
        -quantity_expect: Decimal
        -quantity_get: Decimal
        -is_quantity_get: Boolean
        -price_expect: Decimal
        -price_get: Decimal
        -total_expect: Decimal
        -total_actual: Decimal
        -expiry_date: Date
        --
        +expense(): BelongsTo
        +material(): BelongsTo
        +unit(): BelongsTo
    }
}

package "Produksi" #PaleGreen {
    class Production {
        -id: UUID
        -production_number: String
        -transaction_id: UUID
        -method: String
        -date: Date
        -time: Time
        -start_date: Date
        -end_date: Date
        -note: String
        -status: String
        -is_start: Boolean
        -is_finish: Boolean
        --
        +transaction(): BelongsTo
        +details(): HasMany
        +workers(): HasMany
        +generateProductionNumber(): String
    }

    class ProductionDetail {
        -id: UUID
        -production_id: UUID
        -product_id: UUID
        -quantity_plan: Decimal
        -quantity_get: Decimal
        -quantity_fail: Decimal
        -cycle: Decimal
        --
        +production(): BelongsTo
        +product(): BelongsTo
    }

    class ProductionWorker {
        -id: UUID
        -production_id: UUID
        -user_id: UUID
        --
        +production(): BelongsTo
        +user(): BelongsTo
    }
}

package "Transaksi" #LightPink {
    class Transaction {
        -id: UUID
        -user_id: UUID
        -customer_id: UUID
        -invoice_number: String
        -name: String
        -phone: String
        -date: Date
        -time: Time
        -start_date: Date
        -end_date: Date
        -note: Text
        -payment_status: String
        -status: String
        -method: String
        -total_amount: Decimal
        -created_by_shift: UUID
        --
        +generateInvoiceNumber(): String
        +details(): HasMany
        +payments(): HasMany
    }

    class TransactionDetail {
        -id: UUID
        -transaction_id: UUID
        -product_id: UUID
        -quantity: SmallInteger
        -price: Decimal
        -pcs_capital_snapshot: Decimal
        --
        +transaction(): BelongsTo
        +product(): BelongsTo
    }

    class Payment {
        -id: UUID
        -receipt_number: String
        -transaction_id: UUID
        -payment_channel_id: UUID
        -payment_method: String
        -payment_group: String
        -paid_amount: Decimal
        -image: String
        -paid_at: Timestamp
        --
        +generateReceiptNumber(): String
    }

    class PaymentChannel {
        -id: UUID
        -type: String
        -group: String
        -bank_name: String
        -account_number: String
        -account_name: String
        -qris_image: String
        -is_active: Boolean
        --
        +payments(): HasMany
    }

    class Shift {
        -id: UUID
        -shift_number: String
        -opened_by: UUID
        -closed_by: UUID
        -start_time: DateTime
        -end_time: DateTime
        -status: String
        -initial_cash: Decimal
        -final_cash: Decimal
        -total_sales: Decimal
        --
        +openedBy(): BelongsTo
        +closedBy(): BelongsTo
        +transactions(): HasMany
    }
}

' ==========================================
' RELASI
' ==========================================

User "1" -- "*" Role : has
Role "1" -- "*" Permission : has

Customer "1" -- "*" Transaction

Category "1" -- "*" ProductCategory
Product "1" -- "*" ProductCategory
Product "1" -- "*" ProductComposition
Product "1" -- "*" TransactionDetail
Product "1" -- "*" ProductionDetail
Product "1" -- "*" OtherCost
TypeCost "1" -- "*" OtherCost
Unit "0..1" -- "*" Unit : base_unit

Material "1" -- "*" MaterialDetail
Material "1" -- "*" MaterialBatch
Material "1" -- "*" ProductComposition
Material "1" -- "*" ExpenseDetail
Material "1" -- "*" IngredientCategoryDetail
MaterialDetail "*" -- "1" Unit
MaterialBatch "*" -- "1" Unit
ProductComposition "*" -- "1" Unit

IngredientCategory "1" -- "*" IngredientCategoryDetail

Supplier "1" -- "*" Expense
Expense "1" -- "*" ExpenseDetail

Production "1" -- "*" ProductionDetail
Production "1" -- "*" ProductionWorker
Production "0..1" -- "1" Transaction
ProductionWorker "*" -- "1" User

User "1" -- "*" Transaction
User "1" -- "*" Shift : opened_by
User "1" -- "*" Shift : closed_by
Transaction "1" -- "*" TransactionDetail
Transaction "1" -- "*" Payment
Shift "1" -- "*" Transaction
PaymentChannel "1" -- "*" Payment

@enduml
