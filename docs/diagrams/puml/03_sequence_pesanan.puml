@startuml Sequence - Transaksi Pesanan (DP/Lunas)

actor Kasir
participant "Transaksi Page\n(Livewire)" as Page
participant Customer
participant Transaction
participant TxDetail
participant Production
participant ProdDetail
participant Payment
participant Notification as Notif
database DB

Kasir -> Page: pilih metode\n(pesanan-reguler/kotak)
Kasir -> Page: pilih produk, qty,\njadwal ambil
Kasir -> Page: input pelanggan (phone)

Page -> Customer: firstOrCreate(phone)
Customer -> DB: SELECT/INSERT customers
DB --> Customer: customer

Kasir -> Page: pilih DP atau Lunas

Page -> Transaction: create(invoice_number,\ncustomer_id, method,\nstatus="Antrian",\npayment_status=DP/Lunas,\nschedule, total_amount)
Transaction -> DB: INSERT transactions
DB --> Transaction: transaksi

Page -> TxDetail: createMany(items)
TxDetail -> DB: INSERT transaction_details

== Produksi otomatis ==
Page -> Production: create(production_number,\ntransaction_id,\nmethod,\nstatus="Antrian")
Production -> DB: INSERT productions
DB --> Production: production

Page -> ProdDetail: createMany(items)
ProdDetail -> DB: INSERT production_details

== Pembayaran ==
alt DP/Lunas dibayar sekarang
    Page -> Payment: create(transaction_id,\npayment_channel_id?,\npayment_method,\npaid_amount)
    Payment -> DB: INSERT payments
end

Page -> Notif: orderQueued(invoice_number)
Notif -> DB: INSERT notifications\n(kasir & produksi)

Page --> Kasir: Pesanan tersimpan

@enduml
